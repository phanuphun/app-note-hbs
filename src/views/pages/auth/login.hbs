  <div class="card bg-base-100 w-96 shadow-sm">
    <div class="card-body">
      <h2 class="card-title justify-center">Login</h2>
      <form id="loginForm" method="POST" class="flex flex-col gap-4">
        <div class="form-control">
          <label class="label">
            <span class="label-text">Username</span>
          </label>
          <input
            type="text"
            name="username"
            placeholder="username"
            class="input input-bordered w-full"
            required
          />
        </div>
        <div class="form-control">
          <label class="label">
            <span class="label-text">Password</span>
          </label>
          <input
            type="password"
            name="password"
            placeholder="password"
            class="input input-bordered w-full"
            required
          />
        </div>
        <div class="flex flex-row justify-end">
          <a href="/register" class="link link-primary">Create an account</a>
        </div>

        <div class="form-control">
          <button type="submit" class="w-full btn btn-primary mt-4">Login</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  const form = document.getElementById('loginForm');
  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const fd = new FormData(form);
    const payload = new URLSearchParams(fd); // ให้ Express urlencoded รับได้

    const res = await fetch('/api/v1/auth/login', {
      method: 'POST',
      headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
      body: payload.toString()
    });

    const result = await res.json();
    if (result.ok) {
      const user = result.data.user;
      const token = result.data.token;
      localStorage.setItem('user', JSON.stringify(user));
      localStorage.setItem('token', JSON.stringify(token));
      msg.success('Login successful!');
      setTimeout(() => {
        window.location.href = result.redirectTo || '/';
      }, 1000);
    } else {
      msg.error(result.message || 'Login failed');  
    }
  });
</script>